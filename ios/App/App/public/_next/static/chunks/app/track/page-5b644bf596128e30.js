(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[970],{47141:(e,n,s)=>{Promise.resolve().then(s.bind(s,68154))},66695:(e,n,s)=>{"use strict";s.d(n,{BT:()=>c,Wu:()=>d,ZB:()=>o,Zp:()=>l,aR:()=>i});var a=s(95155),r=s(12115),t=s(59434);let l=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:n,className:(0,t.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...r})});l.displayName="Card";let i=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:n,className:(0,t.cn)("flex flex-col space-y-1.5 p-6",s),...r})});i.displayName="CardHeader";let o=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:n,className:(0,t.cn)("text-2xl font-semibold leading-none tracking-tight",s),...r})});o.displayName="CardTitle";let c=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:n,className:(0,t.cn)("text-sm text-muted-foreground",s),...r})});c.displayName="CardDescription";let d=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:n,className:(0,t.cn)("p-6 pt-0",s),...r})});d.displayName="CardContent",r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)("div",{ref:n,className:(0,t.cn)("flex items-center p-6 pt-0",s),...r})}).displayName="CardFooter"},68154:(e,n,s)=>{"use strict";s.r(n),s.d(n,{default:()=>ee});var a=s(95155),r=s(12115),t=s(30285),l=s(66695),i=s(69321),o=s(44972),c=s(13300),d=s(54633),u=s(54165),x=s(62523),h=s(85057),m=s(59409),j=s(26126),f=s(62177),g=s(90221),p=s(55594),y=s(17759),v=s(10518),N=s(18763),b=s(77223),w=s(59119);let S=p.Ik({duration:p.ai().positive("Duration must be positive."),miles:p.ai().min(0,"Miles must be non-negative."),weather:p.k5(["Sunny","Cloudy","Rainy","Snowy"]),timeOfDay:p.k5(["Morning","Afternoon","Evening","Night"])});function C(e){let{isOpen:n,onOpenChange:s,session:l,onSave:i,onResume:o,onDiscard:d}=e,[p,C]=(0,r.useState)(!1),R=(0,f.mN)({resolver:(0,g.u)(S),values:{duration:l.duration,miles:parseFloat(l.miles.toFixed(2)),weather:l.weather,timeOfDay:l.timeOfDay}});return n?(0,a.jsx)(u.lG,{open:n,onOpenChange:s,children:(0,a.jsx)(u.Cf,{className:"sm:max-w-[480px]",children:(0,a.jsx)(y.lV,{...R,children:(0,a.jsxs)("form",{onSubmit:R.handleSubmit(e=>{i({...l,...e,timeOfDay:e.timeOfDay}),C(!1)}),children:[(0,a.jsxs)(u.c7,{children:[(0,a.jsx)(u.L3,{className:"font-headline",children:"Session Complete"}),(0,a.jsx)(u.rr,{children:"Review your driving session. Save it to your log or make edits."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(y.zB,{control:R.control,name:"duration",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Duration (seconds)"}),(0,a.jsx)(y.MJ,{children:(0,a.jsx)(x.p,{type:"number",...n,disabled:!p,onChange:e=>n.onChange(parseInt(e.target.value,10))})}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:R.control,name:"miles",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Miles"}),(0,a.jsx)(y.MJ,{children:(0,a.jsx)(x.p,{type:"number",step:"0.1",...n,disabled:!p,onChange:e=>n.onChange(parseFloat(e.target.value))})}),(0,a.jsx)(y.C5,{})]})}})]}),(0,a.jsx)(y.zB,{control:R.control,name:"weather",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Weather"}),(0,a.jsxs)(m.l6,{onValueChange:n.onChange,defaultValue:n.value,disabled:!p,children:[(0,a.jsx)(y.MJ,{children:(0,a.jsx)(m.bq,{children:(0,a.jsx)(m.yv,{placeholder:"Select weather"})})}),(0,a.jsxs)(m.gC,{children:[(0,a.jsx)(m.eb,{value:"Sunny",children:"Sunny"}),(0,a.jsx)(m.eb,{value:"Cloudy",children:"Cloudy"}),(0,a.jsx)(m.eb,{value:"Rainy",children:"Rainy"}),(0,a.jsx)(m.eb,{value:"Snowy",children:"Snowy"})]})]}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:R.control,name:"timeOfDay",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Time of Day"}),(0,a.jsxs)(m.l6,{onValueChange:n.onChange,defaultValue:n.value,disabled:!p,children:[(0,a.jsx)(y.MJ,{children:(0,a.jsx)(m.bq,{children:(0,a.jsx)(m.yv,{placeholder:"Select time of day"})})}),(0,a.jsxs)(m.gC,{children:[(0,a.jsx)(m.eb,{value:"Morning",children:"Morning"}),(0,a.jsx)(m.eb,{value:"Afternoon",children:"Afternoon"}),(0,a.jsx)(m.eb,{value:"Evening",children:"Evening"}),(0,a.jsx)(m.eb,{value:"Night",children:"Night"})]})]}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(h.J,{children:"Road Types Driven"}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:l.roadTypes.map(e=>(0,a.jsx)(j.E,{variant:"secondary",children:e},e))})]})]}),(0,a.jsxs)(u.Es,{className:"grid grid-cols-2 sm:grid-cols-4 gap-2",children:[(0,a.jsxs)(t.$,{type:"button",variant:"outline",onClick:()=>C(!p),className:"col-span-1",children:[p?(0,a.jsx)(v.A,{className:"mr-2 h-4 w-4"}):(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),p?"Done":"Edit"]}),(0,a.jsxs)(t.$,{type:"button",variant:"destructive",onClick:d,className:"col-span-1",children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"})," Discard"]}),(0,a.jsxs)(t.$,{type:"button",onClick:o,className:"col-span-1",children:[(0,a.jsx)(c.A,{className:"mr-2 h-4 w-4"})," Resume"]}),(0,a.jsxs)(t.$,{type:"submit",className:"col-span-1",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"})," Save"]})]})]})})})}):null}var R=s(37101);function A(e){return e*Math.PI/180}var M=s(36936),k=s(56603),D=s(84220),O=s(16610);let I=e=>{let n=Math.floor(e/3600),s=Math.floor(e%3600/60);return"".concat(String(n).padStart(2,"0"),":").concat(String(s).padStart(2,"0"),":").concat(String(e%60).padStart(2,"0"))},T=()=>{let e=new Date().getHours();return e>=5&&e<12?"Morning":e>=12&&e<17?"Afternoon":e>=17&&e<21?"Evening":"Night"},E=e=>e>=200&&e<600?"Rainy":e>=600&&e<700?"Snowy":800===e?"Sunny":e>800?"Cloudy":"Sunny",B=e=>{let{weather:n}=e;switch(n){case"Sunny":return(0,a.jsx)(M.A,{className:"w-5 h-5 text-yellow-500"});case"Cloudy":return(0,a.jsx)(k.A,{className:"w-5 h-5 text-gray-500"});case"Rainy":return(0,a.jsx)(D.A,{className:"w-5 h-5 text-blue-500"});case"Snowy":return(0,a.jsx)(O.A,{className:"w-5 h-5 text-cyan-500"});default:return(0,a.jsx)(M.A,{className:"w-5 h-5"})}};function V(e){let{onSaveSession:n}=e,[s,u]=(0,r.useState)("idle"),[x,h]=(0,r.useState)(0),[m,j]=(0,r.useState)(0),[f,g]=(0,r.useState)("Residential"),[p,y]=(0,r.useState)(new Set),[v,N]=(0,r.useState)("Sunny"),[b,w]=(0,r.useState)("Afternoon"),[S,M]=(0,r.useState)(!1),k=(0,r.useRef)(null),D=(0,r.useRef)(null),O=(0,r.useRef)(null),V=async(e,n)=>{try{let s="d0f6b3e6d65bb1e9bf360dbbd052a05f";if(!s)return void console.error("OpenWeather API key is missing.");let a=await fetch("https://api.openweathermap.org/data/2.5/weather?lat=".concat(e,"&lon=").concat(n,"&appid=").concat(s));if(!a.ok)throw Error("Failed to fetch weather data");let r=(await a.json()).weather[0].id;N(E(r))}catch(e){console.error("Could not fetch weather:",e),N("Sunny")}};(0,r.useEffect)(()=>("tracking"===s?(O.current=setInterval(()=>{h(e=>e+1)},1e3),navigator.geolocation?k.current=navigator.geolocation.watchPosition(e=>{let n,{coords:s}=e;if(D.current){let e=function(e,n){let s=e.latitude,a=e.longitude,r=n.latitude,t=n.longitude,l=A(r-s),i=A(t-a),o=Math.sin(l/2)*Math.sin(l/2)+Math.sin(i/2)*Math.sin(i/2)*Math.cos(A(s))*Math.cos(A(r));return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*3958.8}(D.current,s);j(n=>n+e)}else V(s.latitude,s.longitude);D.current=s;let a=s.speed?2.23694*s.speed:0;g(n=a<=30?"Residential":a<=55?"Arterial":"Highway"),y(e=>new Set(e).add(n))},e=>{console.error("Geolocation error:",e),alert("Geolocation is not available or permission was denied. Mileage, road type, and weather will not be tracked automatically.")},{enableHighAccuracy:!0,maximumAge:0,timeout:5e3}):alert("Geolocation is not supported by this browser.")):(O.current&&clearInterval(O.current),k.current&&(navigator.geolocation.clearWatch(k.current),k.current=null),D.current=null),()=>{O.current&&clearInterval(O.current),k.current&&navigator.geolocation.clearWatch(k.current)}),[s]);let q=(0,r.useCallback)(()=>{u("idle"),h(0),j(0),g("Residential"),y(new Set),O.current&&clearInterval(O.current),k.current&&navigator.geolocation.clearWatch(k.current),D.current=null},[]),z=(0,r.useCallback)(e=>{n(e),q(),M(!1)},[n,q]),W=(0,r.useMemo)(()=>({duration:x,miles:m,weather:v,roadTypes:Array.from(p).sort(),timeOfDay:b}),[x,m,v,p,b]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Zp,{className:"shadow-lg",children:(0,a.jsxs)(l.Wu,{className:"flex flex-col items-center justify-center space-y-6 pt-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-muted-foreground",children:"Duration"}),(0,a.jsx)("div",{className:"text-5xl font-bold font-mono tracking-tighter ".concat("tracking"===s?"animate-pulse text-primary":""),children:I(x)})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-6 w-full text-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Miles"}),(0,a.jsxs)("p",{className:"font-bold text-2xl flex items-center justify-center gap-2",children:[(0,a.jsx)(i.A,{}),m.toFixed(2)]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Time of Day"}),(0,a.jsxs)("p",{className:"font-bold text-2xl flex items-center justify-center gap-2",children:[(0,a.jsx)(R.Y,{timeOfDay:b}),b]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Weather"}),(0,a.jsxs)("p",{className:"font-bold text-2xl flex items-center justify-center gap-2",children:[(0,a.jsx)(B,{weather:v}),v]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-muted-foreground text-sm",children:"Road Type"}),(0,a.jsxs)("p",{className:"font-bold text-2xl flex items-center justify-center gap-2",children:[(0,a.jsx)(o.A,{}),f]})]})]}),"idle"===s?(0,a.jsxs)(t.$,{size:"lg",className:"w-full",onClick:()=>{w(T()),y(new Set().add("Residential")),u("tracking")},children:[(0,a.jsx)(c.A,{className:"mr-2 h-5 w-5"})," Start Tracking"]}):(0,a.jsxs)(t.$,{size:"lg",className:"w-full",variant:"destructive",onClick:()=>{u("stopped"),M(!0)},children:[(0,a.jsx)(d.A,{className:"mr-2 h-5 w-5"})," Stop Session"]})]})}),W&&(0,a.jsx)(C,{isOpen:S,onOpenChange:M,session:W,onSave:z,onResume:()=>{u("tracking"),M(!1)},onDiscard:()=>{q(),M(!1)}})]})}var q=s(68437),z=s(6616),W=s(35695),J=s(60704),_=s(59434);let F=J.bL,$=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)(J.B8,{ref:n,className:(0,_.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});$.displayName=J.B8.displayName;let H=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)(J.l9,{ref:n,className:(0,_.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});H.displayName=J.l9.displayName;let Z=r.forwardRef((e,n)=>{let{className:s,...r}=e;return(0,a.jsx)(J.UC,{ref:n,className:(0,_.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});Z.displayName=J.UC.displayName;var G=s(99297),L=s(87481),P=s(63939);let Y=[{value:"Residential",label:"Residential"},{value:"Arterial",label:"Arterial"},{value:"Highway",label:"Highway"}],U=p.Ik({date:p.p6({required_error:"A date is required."}),duration:p.au.number().min(1,"Duration must be at least 1 minute."),miles:p.au.number().optional(),weather:p.k5(["Sunny","Cloudy","Rainy","Snowy"],{required_error:"Weather condition is required."}),roadTypes:p.YO(p.Yj()).min(1,"At least one road type is required."),timeOfDay:p.k5(["Morning","Afternoon","Evening","Night"],{required_error:"Time of day is required."})});function K(e){let{onSave:n}=e,{toast:s}=(0,L.dj)(),r=(0,f.mN)({resolver:(0,g.u)(U),defaultValues:{date:new Date,duration:30,miles:10,weather:"Sunny",roadTypes:["Residential"],timeOfDay:"Afternoon"}});return(0,a.jsxs)(l.Zp,{className:"shadow-lg",children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsx)(l.ZB,{children:"Enter Driving Session"}),(0,a.jsx)(l.BT,{children:"Manually add a driving session to your log."})]}),(0,a.jsx)(l.Wu,{children:(0,a.jsx)(y.lV,{...r,children:(0,a.jsxs)("form",{onSubmit:r.handleSubmit(function(e){n({...e,miles:e.miles||0,duration:60*e.duration,date:e.date.toISOString(),roadTypes:e.roadTypes,timeOfDay:e.timeOfDay}),s({title:"Session Saved",description:"Your manual driving log has been added."}),r.reset()}),className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[(0,a.jsx)(y.zB,{control:r.control,name:"date",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{className:"flex flex-col",children:[(0,a.jsx)(y.lR,{children:"Date"}),(0,a.jsx)(G.l,{date:n.value,setDate:n.onChange}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:r.control,name:"duration",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Duration (in minutes)"}),(0,a.jsx)(y.MJ,{children:(0,a.jsx)(x.p,{type:"number",placeholder:"e.g. 60",...n})}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:r.control,name:"miles",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Miles Driven (optional)"}),(0,a.jsx)(y.MJ,{children:(0,a.jsx)(x.p,{type:"number",placeholder:"e.g. 25",...n})}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:r.control,name:"weather",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Weather Condition"}),(0,a.jsxs)(m.l6,{onValueChange:n.onChange,defaultValue:n.value,children:[(0,a.jsx)(y.MJ,{children:(0,a.jsx)(m.bq,{children:(0,a.jsx)(m.yv,{placeholder:"Select weather..."})})}),(0,a.jsxs)(m.gC,{children:[(0,a.jsx)(m.eb,{value:"Sunny",children:"Sunny"}),(0,a.jsx)(m.eb,{value:"Cloudy",children:"Cloudy"}),(0,a.jsx)(m.eb,{value:"Rainy",children:"Rainy"}),(0,a.jsx)(m.eb,{value:"Snowy",children:"Snowy"})]})]}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:r.control,name:"roadTypes",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Road Types"}),(0,a.jsx)(P.K,{options:Y,onValueChange:n.onChange,defaultValue:n.value,placeholder:"Select road types..."}),(0,a.jsx)(y.C5,{})]})}}),(0,a.jsx)(y.zB,{control:r.control,name:"timeOfDay",render:e=>{let{field:n}=e;return(0,a.jsxs)(y.eI,{children:[(0,a.jsx)(y.lR,{children:"Time of Day"}),(0,a.jsxs)(m.l6,{onValueChange:n.onChange,defaultValue:n.value,children:[(0,a.jsx)(y.MJ,{children:(0,a.jsx)(m.bq,{children:(0,a.jsx)(m.yv,{placeholder:"Select time of day..."})})}),(0,a.jsxs)(m.gC,{children:[(0,a.jsx)(m.eb,{value:"Morning",children:"Morning"}),(0,a.jsx)(m.eb,{value:"Afternoon",children:"Afternoon"}),(0,a.jsx)(m.eb,{value:"Evening",children:"Evening"}),(0,a.jsx)(m.eb,{value:"Night",children:"Night"})]})]}),(0,a.jsx)(y.C5,{})]})}})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsxs)(t.$,{type:"submit",children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"Save Manual Session"]})})]})})})]})}var Q=s(1796),X=s(58186);function ee(){let{addSession:e}=(0,z.t)(),{user:n,loading:s}=(0,q.A)(),t=(0,W.useRouter)();return((0,r.useEffect)(()=>{s||n||t.push("/login")},[n,s,t]),s||!n)?(0,a.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,a.jsx)("div",{className:"text-2xl",children:"Loading..."})}):(0,a.jsx)("main",{className:"min-h-screen bg-background text-foreground",children:(0,a.jsxs)("div",{className:"container mx-auto p-4 sm:p-6 lg:p-8",children:[(0,a.jsx)("header",{className:"mb-8",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-2",children:[(0,a.jsx)(X.A,{}),(0,a.jsx)("h1",{className:"text-4xl font-bold font-headline tracking-tight text-primary",children:"Log a Session"})]}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Track a live session or enter one manually."})]})}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)("div",{className:"w-full lg:w-3/4 xl:w-2/3",children:(0,a.jsxs)(F,{defaultValue:"auto",className:"w-full",children:[(0,a.jsxs)($,{className:"grid w-full grid-cols-2",children:[(0,a.jsxs)(H,{value:"auto",children:[(0,a.jsx)(i.A,{className:"mr-2 h-4 w-4"}),"Automatic Tracker"]}),(0,a.jsxs)(H,{value:"manual",children:[(0,a.jsx)(Q.A,{className:"mr-2 h-4 w-4"}),"Manual Entry"]})]}),(0,a.jsx)(Z,{value:"auto",className:"mt-6",children:(0,a.jsx)(V,{onSaveSession:e})}),(0,a.jsx)(Z,{value:"manual",className:"mt-6",children:(0,a.jsx)(K,{onSave:e})})]})})})]})})}}},e=>{var n=n=>e(e.s=n);e.O(0,[644,291,829,171,2,666,617,106,441,684,358],()=>n(47141)),_N_E=e.O()}]);